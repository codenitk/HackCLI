#! /usr/bin/env python


from os.path import expanduser
import sys
import subprocess


def set_something(something):
    HOME = expanduser("~")
    capitalizeSomething = something[:1] + something[1:].lower()
    path = input("Enter the path of the " + capitalizeSomething + ": ")
    overallSettings = ""
    with open(HOME + "/.he_conf", "r") as conf:
        for line in conf:
            settings = line.split(':')
            if settings[0] == something:
                settings[1] = path + '\n'

            overallSettings += ':'.join(settings)
    with open(HOME + "/.he_conf", "w") as conf:
        conf.write(overallSettings)


def edit():
    HOME = expanduser("~")
    overallSettings=dict()
    with open(HOME + "/.he_conf","r") as conf:
        for line in conf:
            settings = line.split(":")
            settings[1]=settings[1][:-1]
            overallSettings[settings[0]] = settings[1]
    for key in overallSettings.keys():
        if key=="EDITOR":
            if overallSettings[key]=="None":
                print("Please set your editor first!")
            else:
                if overallSettings["TEMPLATE"] != "None":
                    subprocess.call(["cp",overallSettings["TEMPLATE"],sys.argv[1]])
                subprocess.call([overallSettings["EDITOR"],sys.argv[1]])

def run():
    HOME = expanduser("~")
    CLIENT_ID = ""
    CLIENT_SECRET = ""
    LANG = ""
    SOURCE = ""
    filepath = ""
    with open(HOME + "/.he_conf","r") as conf:
        for line in conf:
            settings = line.split(":")
            settings[1]=settings[1][:-1]
            if settings[0]=="CLIENT_ID":
                CLIENT_ID = settings[1]
            if settings[0]=="CLIENT_SECRET":
                CLIENT_SECRET = settings[1]
            if settings[0]=="LANG":
                LANG = settings[1]
            if settings[0]=="FILEPATH":
                filepath = settings[1]
    fileName = filepath + sys.argv[3]
    with open(fileName,"r") as conf:
        SOURCE = conf.read()

    data = {
        'client_id':CLIENT_ID,
        'client_secret':CLIENT_SECRET,
        'lang':LANG,
        'source':SOURCE
    }

    response = post("https://api.hackerearth.com/hackathon/v1/live-events/", data=data).json()
    live_events = response['live_events']
    isContestNameCorrect = False
    for events in live_events:
        if events['title'] == sys.argv[1]:
            isContestNameCorrect = True
            contestUUID = events['uuid']
    if isContestNameCorrect == True:
        response = post("https://api.hackerearth.com/hackathon/v1/" + contestUUID + "/problems/", data=data).json()
        problems = response['problems']
        problem_exists = False
        problemHash = ""
        problemType = ""
        for problem in problems:
            if problem['title'] == sys.argv[2]:
                problem_exists = True
                problemHash = problem['hash']
                problemType = problem['type']
        if problem_exists == True:
            response = post("https://api.hackerearth.com/hackathon/v1/" + contestUUID + "/problem/" + problemType + "/" + problemHash + "/run/" , data=data).json()
            if response['mcode'] == "SUCCESS":
                print("Submitting...")
                time.sleep(5)
                print("Compiling...")
                time.sleep(5)
                print("Running...")
                time.sleep(5)
                print("Fetching results...")
                time.sleep(5)
                submission_id = response['submission']['id']
                response = post("https://api.hackerearth.com/hackathon/v1/" + contestUUID + "/problem/algorithm/" + problemHash + "/submission/"+str(submission_id)+"/" , data=data).json()
                r=response
                print("Submission id -",r['submission']['id'])
                print("Result -",r['submission']['result'])
                print("Memory -",r['submission']['memory'])
                print("Time -",r['submission']['time'])
                print("Score -",r['submission']['score'])
            else:
                print("Kuch galat hai bhai!")
        else:
            print("Problem name galat hai!")
    else:
        print("Contest name sahi daal bc!")

def show():
    print("\n")
    HOME = expanduser("~")
    with open(HOME + "/.he_conf","r") as conf:
        for line in conf:
            p = line.split(':')
            p[0] = p[0][:1] + p[0][1:].lower()
            p[1] = p[1][:-1]
            print(p[0]+ ":" + p[1] + "\n")




